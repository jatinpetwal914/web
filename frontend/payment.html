<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment | Phadizon</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <style>
        .payment-container {
            min-height: 80vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }
        .payment-card {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
            animation: fadeIn 0.5s ease-out;
        }
        .payment-card h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        .payment-amount {
            font-size: 2.5rem;
            color: var(--accent-green);
            font-weight: bold;
            margin: 1.5rem 0;
        }
        .pay-btn {
            background: var(--primary);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.3s, background 0.3s;
            width: 100%;
        }
        .pay-btn:hover {
            transform: scale(1.02);
            background: #2a2c6b;
        }
    </style>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

    <!-- Header -->
    <nav class="navbar">
        <div class="logo-container">
            <h1 class="logo">Phadizon</h1>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="cart.html">Cart</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="content.html">Content</a></li>
        </ul>
        <div class="user-icon">
            <a href="dashboard.html"><i class="fa-regular fa-user"></i></a>
        </div>
    </nav>

    <!-- Payment Section -->
    <section class="payment-container">
        <div class="payment-card" data-aos="zoom-in">
            <h2>Complete Your Payment</h2>
            <p>Secure payment via Razorpay</p>
            
            <div class="payment-amount" id="payAmount">₹0</div>
            
            <button onclick="pay()" class="pay-btn">Pay Now</button>
        </div>
    </section>

    <!-- AI Assistant Button -->
    <div class="ai-assistant">
        <button id="ai-btn" title="AI Assistant">
            <i class="fa-solid fa-robot"></i>
        </button>
    </div>

    <!-- Floating Search Button -->
    <div class="floating-search">
        <button id="side-search-btn" onclick="openSearch()" title="Search">
            <i class="fa-solid fa-magnifying-glass"></i>
        </button>
    </div>

    <!-- Search Overlay -->
    <div id="searchOverlay" class="search-overlay">
        <button class="search-close" onclick="closeSearch()">&times;</button>
        <div class="search-overlay-content">
            <input type="text" id="overlaySearchInput" placeholder="Type to search...">
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>AOS.init();</script>
    <script src="js/main.js"></script>
    <script src="js/ai.js"></script>
    <script>
        const API_BASE = 'http://localhost:5000/api';
        
        // Check for token
        const token = localStorage.getItem('token');
        if (!token) window.location.href = 'login.html';

        // Load cart total (Mock or actual)
        async function loadTotal() {
            try {
                const res = await fetch(`${API_BASE}/cart`, {
                    headers: { 'Authorization': token }
                });
                const data = await res.json();
                if (Array.isArray(data)) {
                    const total = data.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    document.getElementById('payAmount').innerText = '₹' + total;
                    return total;
                }
            } catch (e) {
                console.error(e);
                document.getElementById('payAmount').innerText = '₹1200'; // Fallback demo amount
                return 1200;
            }
            return 0;
        }

        loadTotal();

        async function pay() {
            const total = await loadTotal(); // Refresh total
            if (total === 0) {
                alert("Cart is empty!");
                return;
            }

            try {
                const order = await fetch(`${API_BASE}/payment/create-order`, {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token
                    },
                    body: JSON.stringify({ amount: total })
                }).then(res => res.json());

                const options = {
                    key: "YOUR_KEY_ID", // Replace with actual key
                    amount: order.amount,
                    currency: "INR",
                    name: "Phadizon",
                    description: "Purchase from Phadizon",
                    order_id: order.id,
                    handler: function (response) {
                        fetch(`${API_BASE}/payment/verify`, {
                            method: "POST",
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': token
                            },
                            body: JSON.stringify({
                                ...response,
                                total
                            })
                        }).then(() => {
                            alert("Payment Successful");
                            window.location.href = "orders.html";
                        });
                    },
                    prefill: {
                        name: "User Name",
                        email: "user@example.com",
                        contact: "9999999999"
                    },
                    theme: {
                        color: "#1a1b4b"
                    }
                };

                const rzp1 = new Razorpay(options);
                rzp1.open();
            } catch (error) {
                console.error("Payment Error", error);
                alert("Payment initiation failed. Using demo success.");
                // Demo success fallback
                window.location.href = "orders.html";
            }
        }
    </script>

    <footer class="site-footer" role="contentinfo" aria-label="Site footer">
        <div class="footer-inner">
            <div class="footer-about">
                <a href="index.html" class="logo-link"><span class="logo-symbol">◇</span> Phadizon</a>
                <p>Bringing the goodness of the Himalayas — handcrafted, sustainable, and authentic products from mountain communities.</p>
                <div class="social" aria-label="social links">
                    <a href="https://www.facebook.com/profile.php?id=61585513685094" target="_blank" rel="noopener noreferrer" aria-label="Facebook"><i class="fa-brands fa-facebook"></i><span class="sr-only">Facebook</span></a>
                    <a href="https://www.instagram.com/phadizon/" target="_blank" rel="noopener noreferrer" aria-label="Instagram"><i class="fa-brands fa-instagram"></i><span class="sr-only">Instagram</span></a>
                    <a href="https://www.youtube.com/@phadizon" target="_blank" rel="noopener noreferrer" aria-label="YouTube"><i class="fa-brands fa-youtube"></i><span class="sr-only">YouTube</span></a>
                    <a href="https://www.linkedin.com/in/phadizon-0608983a2/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn"><i class="fa-brands fa-linkedin"></i><span class="sr-only">LinkedIn</span></a>
                </div>
            </div>
            <div class="footer-links" aria-label="Footer links">
                <h4>Quick Links</h4>
                <a href="content.html">Terms</a>
                <a href="content.html#credits">Credits</a>
                <a href="admin/admin-login.html">Admin</a>
                <a href="contact.html">Contact</a>
            </div>
            <div class="footer-newsletter" aria-label="Newsletter signup">
                <h4>Join our newsletter</h4>
                <form id="footerNewsletter" action="#" onsubmit="event.preventDefault(); alert('Thanks! (Demo)');">
                    <label for="footerEmail" class="sr-only">Email</label>
                    <div class="newsletter-input">
                        <input id="footerEmail" type="email" placeholder="Your email address" required>
                        <button type="submit" class="cta-btn-modern">Subscribe</button>
                    </div>
                </form>
                <small class="newsletter-note">We’ll send occasional updates about new products and offers.</small>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="credits">© Phadizon <span id="ph-year"></span></div>
        </div>
    </footer>
    <script>document.getElementById('ph-year')?.appendChild(document.createTextNode(new Date().getFullYear()));</script>
</body>
</html>
